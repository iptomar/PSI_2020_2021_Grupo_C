@model IEnumerable<LuizaAndaluz.Models.Historia>
@{
    ViewData["Title"] = "Home Page";
}


<!-- ======= Hero Section ======= -->
<section id="hero">
    <div class="hero-container">
        <div class="wow fadeIn">
            <div class="hero-logo">
                <img class="" src="assets/img/logo.png" alt="Imperial">
            </div>

            <h1><span class="typed" data-typed-items="Religiosa católica e educadora portuguesa"></span></h1>

            <div class="actions">
                <a href="#about" class="btn-get-started">Histórias</a>
               
            </div>
        </div>
    </div>
</section><!-- End Hero -->
<!-- ======= Header ======= -->


<main id="main">

    <!-- ======= About Section ======= -->
    <section id="about">
        <div class="container wow fadeInUp">
            <div class="row">
                <div class="col-md-12">
                    <h3 class="section-title">Histórias</h3>
                    <div class="section-title-divider"></div>

                </div>
            </div>
        </div>
        <div class="container about-container wow fadeInUp">
            <div class="mx-5">
                <div id="mySidenav" class="sidenav px-2"></div>

                <div id="mapPrincipal"></div>
            </div>

            <script>
    function initMap() {
        var options = {
            zoom: 4,
            center: { lat: 39.6019900, lng: -8.4092400 }
        }

        var map = new google.maps.Map(document.getElementById('mapPrincipal'), options);
        var locais = @Html.Raw(Json.Serialize(@ViewBag.locais));

         for (var i = 0; i < locais.length; i++) {
             const marker = new google.maps.Marker({
                 position: { lat: parseFloat(locais[i].latitude), lng: parseFloat(locais[i].longitude) }, map, title: (i + ""),
             });

            marker.addListener("click", () => {
                openNav();
                lat = parseFloat(marker.getPosition().lat());
                lng = parseFloat(marker.getPosition().lng());

                $.ajax({
                    type: "GET",
                    url: `/Historias/GetHistoriasByLocation?lat=${lat}&lng=${lng}`,
                    contentType: "application/json",
                    dataType: "json",
                    success: function (response) {
                        //populate the form elements with the returned data
                        var s="<div class='row pr-1'>"+
                            "<div class='col-10 align-self-center'><h3>Histórias</h3></div>" +
                            "<div class='col-2'>"+
                                "<button type='button' class='close float-right' onclick='closeNav()' aria-label='Close'>"+
                                    "<span aria-hidden='true'>&times;</span>"+
                                "</button>" +
                            "</div>"+
                        "</div>";

                        response.forEach(element => {
                            console.log(element);
                            s += "<div class='card d-lg-block'>";
                            if (element.conteudo.endsWith('png') || element.conteudo.endsWith("jpg") || element.conteudo.endsWith("gif") || element.conteudo.endsWith("jfif")) {
                                s += "<img src='/Ficheiros/" + element.conteudo + "' class='card-img-top' alt='/Ficheiros/" + element.conteudo + "'>";
                            }
                            else if (element.conteudo.endsWith('mp4') || element.conteudo.endsWith("mov")) {
                                s += "<iframe class='card-img-top' src='/Ficheiros/" + element.conteudo + "' allowfullscreen></iframe>"
                            }
                            else {
                                s += "<img src='/Ficheiros/exemplo.jfif' class='card-img-top' alt='/Ficheiros/exemplo.jfif'>";
                            }
                            s += "<div class='card-body'>" +
                                "<a href='historias/details/" + element.id + "'>" +
                                "<h5 class='card-title'>" + element.titulo + "</h5>" +
                                "</a>" +
                                "<p class='card-text'>" + element.descricao + "</p>" +
                                "<p class='card-text small'>" + element.data + "</p>" +
                                "</div>" +
                                "</div>";
                        });

                        document.getElementById("mySidenav").innerHTML = "";
                        document.getElementById("mySidenav").innerHTML += s;

                    },
                    failure: function (response) {
                        //handle the error
                    }
                });
            });
        }
    }

    function openNav() {
        document.getElementById("mySidenav").style.display = "block";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.display = "none";
    }
            </script>

            <script async defer
                    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzF3-at94AexQQTqYBX26DsWSvQ2h0RF0&callback=initMap">
            </script>
        </div>
    </section><!-- End About Section -->




</main><!-- End #main -->
<!-- ======= Footer ======= -->


<div id="preloader"></div>
<a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

<!-- Vendor JS Files -->
<script src="assets/vendor/jquery/jquery.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/jquery-sticky/jquery.sticky.js"></script>
<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
<script src="assets/vendor/venobox/venobox.min.js"></script>
<script src="assets/vendor/typed.js/typed.min.js"></script>
<script src="assets/vendor/aos/aos.js"></script>

<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>
